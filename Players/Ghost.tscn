[gd_scene load_steps=9 format=2]

[ext_resource path="res://Players/Ghost.gd" type="Script" id=1]
[ext_resource path="res://Players/CharacterBase.tscn" type="PackedScene" id=2]

[sub_resource type="Shader" id=1]
resource_local_to_scene = true
code = "shader_type spatial;
render_mode unshaded;

uniform sampler2D visibility_mask;
uniform vec4 color: hint_color = vec4(1.0, 0.0, 0.0, 1.0);
uniform float visibility_threshold = 0.2;

varying vec3 world_vertex;

void vertex() {
	world_vertex = (WORLD_MATRIX * vec4(VERTEX, 1.0)).xyz;
}

void fragment() {
	vec2 uv = world_vertex.xz;
	uv += vec2(50.0, 50.0);
	uv /= 100.0;
	uv.y = 1.0 - uv.y;
	
	ALPHA = float(length(texture(visibility_mask, uv).rgb) > visibility_threshold);
	ALBEDO = color.rgb;
	//ALBEDO = vec3(uv.x);
}"

[sub_resource type="ShaderMaterial" id=2]
resource_local_to_scene = true
shader = SubResource( 1 )
shader_param/color = Color( 1, 0, 0, 1 )
shader_param/visibility_threshold = 0.2

[sub_resource type="ViewportTexture" id=3]
viewport_path = NodePath("HealthDisplay/Viewport")

[sub_resource type="SpatialMaterial" id=4]
resource_local_to_scene = true
flags_unshaded = true
params_billboard_mode = 1
params_use_alpha_scissor = true
params_alpha_scissor_threshold = 0.32
albedo_texture = SubResource( 3 )

[sub_resource type="Curve3D" id=5]
resource_local_to_scene = true
bake_interval = 512.0
_data = {
"points": PoolVector3Array( 0, 0, 0, 0, 0, 0, -3.98881, 3.43386, 1.44042, 0, 0, 0, 0, 0, 0, -0.111737, 1.87899, -0.587765, 0, 0, 0, 0, 0, 0, 1.25393, -0.967441, -0.492292, 0, 0, 0, 0, 0, 0, 3.51383, -2.88596, -1.31788, 0, 0, 0, 0, 0, 0, 4.95062, -0.942363, -2.95728, 0, 0, 0, 0, 0, 0, -4.62784, -0.826313, -7.40151, 0, 0, 0, 0, 0, 0, -8.53307, -0.875763, -5.8424, 0, 0, 0, 0, 0, 0, -9.03526, -0.930419, -3.95939, 0, 0, 0, 0, 0, 0, -8.04191, -0.952974, -3.13198, 0, 0, 0, 0, 0, 0, -7.48108, -0.96165, -2.80625, 0, 0, 0, 0, 0, 0, -6.48379, -0.960782, -2.79469, 0, 0, 0, 0, 0, 0, -5.31664, -0.946901, -3.22937, 0, 0, 0, 0, 0, 0, -4.58705, -0.92261, -4.04505, 0, 0, 0, 0, 0, 0, 115.73, 12.9276, -45.8355, 0, 0, 0, 0, 0, 0, -175.982, 44.4445, 0.074707, 0, 0, 0, 0, 0, 0, -121.11, -68.6456, 82.6569, 0, 0, 0, 0, 0, 0, 126.057, -89.3479, 38.6484, 0, 0, 0, 0, 0, 0, 148.5, 62.9839, -96.6158, 0, 0, 0, 0, 0, 0, -16.8288, 88.6248, -77.2173, 0, 0, 0, 0, 0, 0, -113.457, 29.3022, -2.62653, 0, 0, 0, 0, 0, 0, -2268.7, -9.19629, 567.552, 0, 0, 0, 0, 0, 0, 577.439, -692.432, 439.454, 0, 0, 0, 0, 0, 0, 2097.27, -83.7314, -457.653, 0, 0, 0, 0, 0, 0, 988.661, 926.628, -1041.26, 0, 0, 0, 0, 0, 0, -594.995, 976.318, -688.675, 0, 0, 0, 0, 0, 0, -1230.21, 504.265, -128.464, 0, 0, 0, 0, 0, 0, -499.906, 317.926, -151.949, 0, 0, 0, 0, 0, 0, -1488.87, 372.332, 48.3367, 0, 0, 0, 0, 0, 0, -3134.36, 462.854, 381.583, 0, 0, 0, 0, 0, 0, 2015.58, 446.224, -888.392, 0, 0, 0, 0, 0, 0, -2248.47, 578.37, 1291.43, 0, 0, 0, 0, 0, 0, -790.279, -483.85, 1514.58, 0, 0, 0, 0, 0, 0, -2252.73, 536.665, 859.362, 0, 0, 0, 0, 0, 0, 956.249, 291.214, -114.372, 0, 0, 0, 0, 0, 0, 45.2701, 526.066, 119.395, 0, 0, 0, 0, 0, 0, -956.426, 784.304, 376.441, 0, 0, 0, 0, 0, 0, -961.383, 1095.55, 180.8, 0, 0, 0, 0, 0, 0, -1313.24, 945.691, 423.917, 0, 0, 0, 0, 0, 0, -1811.59, 1007.17, 594.356, 0, 0, 0, 0, 0, 0, -1206.54, 1379.9, 103.22, 0, 0, 0, 0, 0, 0, -609.1, 1460.59, -199.195, 0, 0, 0, 0, 0, 0, 72.2245, 1406.8, -451.438, 0, 0, 0, 0, 0, 0, 571.907, 1429.85, -676.144, 0, 0, 0, 0, 0, 0, 1022.46, 1072.49, -638.531, 0, 0, 0, 0, 0, 0, -1635.71, 684.398, 725.468, 0, 0, 0, 0, 0, 0, -2077.71, 768.934, 857.575, 0, 0, 0, 0, 0, 0, -2344.73, 968.746, 842.89 ),
"tilts": PoolRealArray( 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 )
}

[sub_resource type="SpatialMaterial" id=6]
flags_unshaded = true
flags_no_depth_test = true
albedo_color = Color( 1, 0, 0, 1 )

[node name="Ghost" instance=ExtResource( 2 )]
script = ExtResource( 1 )

[node name="MeshInstance" parent="." index="1"]
material_override = SubResource( 2 )

[node name="HealthDisplay" parent="." index="4"]
material_override = SubResource( 4 )

[node name="OwnMeshInstance" parent="." index="5"]
material_override = SubResource( 2 )

[node name="ToWorldNode" type="Node" parent="." index="10"]

[node name="PathLine" type="Path" parent="ToWorldNode" index="0"]
curve = SubResource( 5 )

[node name="PathPolygon" type="CSGPolygon" parent="ToWorldNode" index="1"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 3.31969, 0, 0 )
mode = 2
path_node = NodePath("../PathLine")
path_interval = 1.0
path_rotation = 1
path_local = false
path_continuous_u = false
path_joined = false
material = SubResource( 6 )
